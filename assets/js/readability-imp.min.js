"use strict";

function escapeHtml(e) {
  return e.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
}

function get_html_translation_table(e, t) {
  var a,
      r,
      o,
      l = {},
      i = {},
      d = {},
      n = {};
  if (d[0] = "HTML_SPECIALCHARS", d[1] = "HTML_ENTITIES", n[0] = "ENT_NOQUOTES", n[2] = "ENT_COMPAT", n[3] = "ENT_QUOTES", r = isNaN(e) ? e ? e.toUpperCase() : "HTML_SPECIALCHARS" : d[e], o = isNaN(t) ? t ? t.toUpperCase() : "ENT_COMPAT" : n[t], "HTML_SPECIALCHARS" !== r && "HTML_ENTITIES" !== r) throw new Error("Table: " + r + " not supported");

  for (a in l[38] = "&amp;", "HTML_ENTITIES" === r && (l[160] = "&nbsp;", l[161] = "&iexcl;", l[162] = "&cent;", l[163] = "&pound;", l[164] = "&curren;", l[165] = "&yen;", l[166] = "&brvbar;", l[167] = "&sect;", l[168] = "&uml;", l[169] = "&copy;", l[170] = "&ordf;", l[171] = "&laquo;", l[172] = "&not;", l[173] = "&shy;", l[174] = "&reg;", l[175] = "&macr;", l[176] = "&deg;", l[177] = "&plusmn;", l[178] = "&sup2;", l[179] = "&sup3;", l[180] = "&acute;", l[181] = "&micro;", l[182] = "&para;", l[183] = "&middot;", l[184] = "&cedil;", l[185] = "&sup1;", l[186] = "&ordm;", l[187] = "&raquo;", l[188] = "&frac14;", l[189] = "&frac12;", l[190] = "&frac34;", l[191] = "&iquest;", l[192] = "&Agrave;", l[193] = "&Aacute;", l[194] = "&Acirc;", l[195] = "&Atilde;", l[196] = "&Auml;", l[197] = "&Aring;", l[198] = "&AElig;", l[199] = "&Ccedil;", l[200] = "&Egrave;", l[201] = "&Eacute;", l[202] = "&Ecirc;", l[203] = "&Euml;", l[204] = "&Igrave;", l[205] = "&Iacute;", l[206] = "&Icirc;", l[207] = "&Iuml;", l[208] = "&ETH;", l[209] = "&Ntilde;", l[210] = "&Ograve;", l[211] = "&Oacute;", l[212] = "&Ocirc;", l[213] = "&Otilde;", l[214] = "&Ouml;", l[215] = "&times;", l[216] = "&Oslash;", l[217] = "&Ugrave;", l[218] = "&Uacute;", l[219] = "&Ucirc;", l[220] = "&Uuml;", l[221] = "&Yacute;", l[222] = "&THORN;", l[223] = "&szlig;", l[224] = "&agrave;", l[225] = "&aacute;", l[226] = "&acirc;", l[227] = "&atilde;", l[228] = "&auml;", l[229] = "&aring;", l[230] = "&aelig;", l[231] = "&ccedil;", l[232] = "&egrave;", l[233] = "&eacute;", l[234] = "&ecirc;", l[235] = "&euml;", l[236] = "&igrave;", l[237] = "&iacute;", l[238] = "&icirc;", l[239] = "&iuml;", l[240] = "&eth;", l[241] = "&ntilde;", l[242] = "&ograve;", l[243] = "&oacute;", l[244] = "&ocirc;", l[245] = "&otilde;", l[246] = "&ouml;", l[247] = "&divide;", l[248] = "&oslash;", l[249] = "&ugrave;", l[250] = "&uacute;", l[251] = "&ucirc;", l[252] = "&uuml;", l[253] = "&yacute;", l[254] = "&thorn;", l[255] = "&yuml;"), "ENT_NOQUOTES" !== o && (l[34] = "&quot;"), "ENT_QUOTES" === o && (l[39] = "&#39;"), l[60] = "&lt;", l[62] = "&gt;", l) {
    l.hasOwnProperty(a) && (i[String.fromCharCode(a)] = l[a]);
  }

  return i;
}

function html_entity_decode(e, t) {
  var a,
      r = {},
      o = "",
      l = "",
      l = e.toString();
  if (!1 === (r = get_html_translation_table("HTML_ENTITIES", t))) return !1;

  for (o in delete r["&"], r["&"] = "&amp;", r) {
    a = r[o], l = l.split(a).join(o);
  }

  return l = l.split("&#039;").join("'");
}

function allContentModal() {
  jQuery(".toplevel_page_pf-menu").on("shown", ".pfmodal.modal", function (e) {
    document.body.style.overflow = "hidden";
    var o = jQuery(this),
        l = (o.attr("id"), o.attr("pf-item-id")),
        t = o.attr("pf-post-id"),
        a = o.parent().attr("tabindex");
    modalNavigator(a);
    var i = jQuery("#" + l + " #modal-body-" + l + " .main-text").html(),
        r = jQuery("#" + l + " #item_link_" + l).val(),
        d = jQuery("#" + l + " #item_author_" + l).val(),
        n = o.attr("pf-readability-status"),
        u = jQuery("#" + l + " #item_tags_" + l).val(),
        m = jQuery.trim(jQuery("#pf_nomination_nonce").val()),
        c = jQuery("#" + l + " i.schema-read:first");
    c.hasClass("marked-read") ? console.log("Already marked read", c, l) : (console.log("Attempting to mark read", c, l), c.click()), jQuery.post(ajaxurl, {
      action: "pf_ajax_get_comments",
      id_for_comments: t
    }, function (e) {
      jQuery("#" + l + " #modal-" + l + " .modal-comments").html(e);
    }), 1 != n && "opml-feed" != u && (jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .readability-wait").html("<h2>Attempting to retrieve full article.</h2>"), jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .main-text").hide(), jQuery.post(ajaxurl, {
      action: "make_it_readable",
      read_item_id: l,
      url: r,
      content: escape(i),
      post_id: t,
      authorship: d,
      pf_nomination_nonce: m,
      force: "noforce"
    }, function (e) {
      var t,
          a = html_entity_decode(jQuery(e).find("response_data").text()),
          r = jQuery(e).find("readable_status").text();
      "readable" != r ? "secured" == r ? (alert("The content cannot be retrieved. The post may be on a secure page or it may have been removed."), jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .main-text").html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t), o.attr("pf-readability-status", 1)) : "already_readable" == r ? (jQuery("#" + l + " #modal-body-" + l + " .main-text").html(unescape(i)), o.attr("pf-readability-status", 1)) : (jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .main-text").html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t)) : o.attr("pf-readability-status", 1), jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .readability-wait").hide(), jQuery("#" + l + " #modal-" + l + " #modal-body-" + l + " .main-text").show();
    }));
  });
}

function modalReadReset() {
  jQuery(".toplevel_page_pf-menu .pf_container").on("click", ".modal-readability-reset", function (e) {
    e.preventDefault();
    var t = jQuery(this),
        o = t.attr("pf-modal-id"),
        l = t.attr("pf-item-id"),
        a = t.attr("pf-post-id"),
        i = jQuery("#" + l + " #modal-body-" + l).html(),
        r = jQuery("#" + l + " #item_link_" + l).val(),
        d = jQuery("#" + l + " #item_author_" + l).val(),
        n = jQuery.trim(jQuery("#pf_nomination_nonce").val());
    jQuery("#" + l + " #modal-" + l + " #modal-body-" + l).html("Attempting to retrieve full article."), jQuery.post(ajaxurl, {
      action: "make_it_readable",
      read_item_id: l,
      url: r,
      content: escape(i),
      post_id: a,
      authorship: d,
      pf_nomination_nonce: n,
      force: "force"
    }, function (e) {
      jQuery(e).find("response_data").text();
      var t,
          a = html_entity_decode(jQuery(e).find("response_data").text()),
          r = jQuery(e).find("readable_status").text();
      "readable" != r ? "secured" == r ? (alert("The content cannot be retrieved. The post may be on a secure page or it may have been removed."), jQuery("#" + l + " #modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t), jQuery(o).attr("pf-readability-status", 1)) : "already_readable" == r ? (jQuery("#" + l + " #modal-" + l + " #modal-body-" + l).html(unescape(i)), jQuery(o).attr("pf-readability-status", 1)) : (jQuery("#" + l + " #modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t)) : (jQuery("#" + l + " #modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t), jQuery(o).attr("pf-readability-status", 1));
    });
  });
}

function modalNomReadReset() {
  jQuery(".pressforward_page_pf-review .pf_container").on("click", ".modal-readability-reset", function (e) {
    e.preventDefault();
    var t = jQuery(this),
        o = t.attr("pf-modal-id"),
        l = t.attr("pf-item-id"),
        a = t.attr("pf-post-id"),
        i = jQuery("#" + a + " #modal-body-" + l).html(),
        r = jQuery("#" + a + " #permalink_" + l).val(),
        d = jQuery("#" + a + " #authors_" + l).val(),
        n = jQuery.trim(jQuery("#pf_nomination_nonce").val());
    jQuery("#" + a + " #modal-" + l + " #modal-body-" + l).html("Attempting to retrieve full article."), jQuery.post(ajaxurl, {
      action: "make_it_readable",
      read_item_id: l,
      url: r,
      content: escape(i),
      post_id: a,
      authorship: d,
      pf_nomination_nonce: n,
      force: "force"
    }, function (e) {
      jQuery(e).find("response_data").text();
      var t,
          a = html_entity_decode(jQuery(e).find("response_data").text()),
          r = jQuery(e).find("readable_status").text();
      "readable" != r ? "secured" == r ? (alert("The content cannot be retrieved. The post may be on a secure page or it may have been removed."), jQuery("#modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t), jQuery(o).attr("pf-readability-status", 1)) : "already_readable" == r ? (jQuery("#modal-" + l + " #modal-body-" + l).html(unescape(i)), jQuery(o).attr("pf-readability-status", 1)) : (jQuery("#modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t)) : (jQuery("#modal-" + l + " #modal-body-" + l).html(a), t = escapeHtml(a), jQuery("#item_content_" + l).attr("value", t), jQuery(o).attr("pf-readability-status", 1));
    });
  });
}

jQuery(window).on("load", function () {
  allContentModal(), modalReadReset(), modalNomReadReset();
});